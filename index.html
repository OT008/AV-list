<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>√úr√ºn Takip Sistemi</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 30px; }
  h2 { margin-bottom: 15px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; background: white; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #e9ecef; }
  input[type="number"], input[type="text"] { width: 90%; padding: 4px; }
  button { margin: 5px; padding: 6px 12px; border: none; border-radius: 6px; color: white; cursor: pointer; transition: background 0.3s; }
  #btnKullaniciEkle, #btnGenelToplam { background: #0078d7; }
  #btnTemizle { background: #dc3545; }
  button:hover:not(:disabled) { filter: brightness(0.9); }
  button:disabled { background: #b0b0b0 !important; cursor: not-allowed; }
  .btnAdd { background: #28a745; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-weight: bold; }
  .btnRemove { background: #dc3545; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-weight: bold; }
  .btnAdd:disabled, .btnRemove:disabled { background: #b0b0b0; cursor: not-allowed; }
  #genelToplamSatir td { background: #fff8dc; font-weight: bold; }
  #genelToplamSatir td:first-child { border-left: 2px solid #ccc; }
</style>
</head>
<body>

<h2>√úr√ºn Takip Sistemi</h2>

<div>
  <input type="text" id="kullaniciAdi" placeholder="Kullanƒ±cƒ± adƒ± giriniz">
  <button id="btnKullaniciEkle" onclick="kullaniciEkle()">Kullanƒ±cƒ± Ekle</button>
  <button id="btnGenelToplam" onclick="genelToplam()">Genel Toplam</button>
  <button id="btnTemizle" onclick="tabloTemizle()">Tabloyu Temizle</button>
</div>

<table id="urunTablo">
  <thead>
    <tr id="baslikSatir">
      <th></th>
      <th>Sƒ∞TE</th>
      <th>√úR√úN</th>
      <th>ADET Fƒ∞YATI</th>
      <th>ALINAN ADET</th>
      <th>TOPLAM Fƒ∞YAT</th>
    </tr>
  </thead>
  <tbody id="urunBody">
    <tr>
      <td><button class="btnAdd" onclick="satirEkle(this)">+</button></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="number" min="0" value="0"></td>
      <td><input type="number" min="0" value="0"></td>
      <td class="readonly"></td>
    </tr>
  </tbody>
</table>

<script>
function kullaniciEkle() {
  const ad = document.getElementById("kullaniciAdi").value.trim();
  if (!ad) { alert("L√ºtfen bir kullanƒ±cƒ± adƒ± giriniz."); return; }

  const baslik = document.getElementById("baslikSatir");
  const thAdet = document.createElement("th");
  thAdet.textContent = ad + " ADET";
  const thFiyat = document.createElement("th");
  thFiyat.textContent = ad + " Fƒ∞YAT";
  baslik.appendChild(thAdet);
  baslik.appendChild(thFiyat);

  const satirlar = document.querySelectorAll("#urunBody tr");
  satirlar.forEach(tr => {
    const adet = document.createElement("td");
    adet.innerHTML = `<input type="number" min="0" value="0">`;
    const fiyat = document.createElement("td");
    fiyat.classList.add("readonly");
    tr.appendChild(adet);
    tr.appendChild(fiyat);
  });

  document.getElementById("kullaniciAdi").value = "";
}

function satirEkle(btn) {
  const tr = btn.closest("tr");
  const yeniSatir = tr.cloneNode(true);
  yeniSatir.querySelectorAll("input").forEach(inp => {
    inp.value = (inp.type === "number") ? 0 : "";
  });

  const ustBtn = tr.querySelector(".btnAdd");
  ustBtn.textContent = "‚àí";
  ustBtn.className = "btnRemove";
  ustBtn.onclick = function() { satirSil(this); };

  yeniSatir.cells[0].innerHTML = `<button class="btnAdd" onclick="satirEkle(this)">+</button>`;
  tr.insertAdjacentElement("afterend", yeniSatir);
}

function satirSil(btn) {
  btn.closest("tr").remove();
}

function urunleriHesapla() {
  const satirlar = document.querySelectorAll("#urunBody tr");
  satirlar.forEach(tr => {
    const fiyat = Number(tr.cells[3].querySelector("input").value);
    const adet = Number(tr.cells[4].querySelector("input").value);
    tr.cells[5].textContent = (fiyat * adet).toFixed(2);

    for (let j = 6; j < tr.cells.length; j += 2) {
      const adetK = tr.cells[j].querySelector("input");
      if (adetK) {
        const val = Number(adetK.value);
        const fiyatK = tr.cells[j + 1];
        fiyatK.textContent = (val * fiyat).toFixed(2);
      }
    }
  });
}

function genelToplam() {
  const btn = document.getElementById("btnGenelToplam");
  const tablo = document.getElementById("urunTablo");
  const mevcutSatir = document.getElementById("genelToplamSatir");
  const btnKullanici = document.getElementById("btnKullaniciEkle");

  if (mevcutSatir) {
    mevcutSatir.remove();
    btn.style.background = "#0078d7";
    btnKullanici.disabled = false;
    toggleSatirButonlari(true);
    return;
  }

  urunleriHesapla();
  const satirlar = document.querySelectorAll("#urunBody tr");
  let hataVar = false;

  satirlar.forEach(tr => {
    let toplamAdet = 0;
    for (let j = 6; j < tr.cells.length; j += 2) {
      const adet = tr.cells[j].querySelector("input");
      if (adet) toplamAdet += Number(adet.value);
    }
    const alinan = Number(tr.cells[4].querySelector("input").value);
    const adetHucre = tr.cells[4].querySelector("input");
    if (alinan === toplamAdet) {
      adetHucre.style.background = "#90EE90";
    } else {
      adetHucre.style.background = "#FF6347";
      hataVar = true;
    }
  });

  if (hataVar) {
    btn.style.background = "#dc3545";
    alert("Bazƒ± √ºr√ºnlerde daƒüƒ±tƒ±lan adet ile alƒ±nan adet e≈üle≈ümiyor!");
    return;
  }

  btn.style.background = "#28a745";

  const toplamSatirYeni = tablo.insertRow(-1);
  toplamSatirYeni.id = "genelToplamSatir";

  // GENEL TOPLAM h√ºcresi ‚Äì 5 s√ºtun birle≈üik (+, Sƒ∞TE, √úR√úN, ADET Fƒ∞YATI, ALINAN ADET)
  const genelHucre = toplamSatirYeni.insertCell(0);
  genelHucre.colSpan = 5;
  genelHucre.textContent = "GENEL TOPLAM";
  genelHucre.style.textAlign = "center";

  // TOPLAM Fƒ∞YAT h√ºcresi
  let toplamFiyat = 0;
  satirlar.forEach(tr => toplamFiyat += Number(tr.cells[5].textContent) || 0);
  const tdToplam = toplamSatirYeni.insertCell(-1);
  tdToplam.textContent = toplamFiyat.toFixed(2) + " ‚Ç∫";

  // üîπ Her ‚ÄúFƒ∞YAT‚Äù s√ºtunu i√ßin ki≈üi toplamƒ± ekle
  const basliklar = document.querySelectorAll("#baslikSatir th");
  for (let i = 0; i < basliklar.length; i++) {
    if (basliklar[i].textContent.endsWith("Fƒ∞YAT") && i > 5) { // sadece kullanƒ±cƒ± s√ºtunlarƒ±
      const kisiAdi = basliklar[i].textContent.replace(" Fƒ∞YAT", "").trim();
      let kisiToplam = 0;
      satirlar.forEach(tr => {
        const hucre = tr.cells[i];
        if (hucre) kisiToplam += Number(hucre.textContent) || 0;
      });

      const tdYazi = toplamSatirYeni.insertCell(-1);
      tdYazi.textContent = `${kisiAdi} √ñdeyeceƒüi`;
      const tdTutar = toplamSatirYeni.insertCell(-1);
      tdTutar.textContent = `${kisiToplam.toFixed(2)} ‚Ç∫`;
    }
  }

  btnKullanici.disabled = true;
  toggleSatirButonlari(false);
}

function toggleSatirButonlari(aktif) {
  document.querySelectorAll(".btnAdd, .btnRemove").forEach(btn => {
    btn.disabled = !aktif;
  });
}

function tabloTemizle() {
  const tbody = document.getElementById("urunBody");
  tbody.innerHTML = `
    <tr>
      <td><button class="btnAdd" onclick="satirEkle(this)">+</button></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="number" min="0" value="0"></td>
      <td><input type="number" min="0" value="0"></td>
      <td class="readonly"></td>
    </tr>`;
  document.getElementById("baslikSatir").innerHTML = `
      <th></th>
      <th>Sƒ∞TE</th>
      <th>√úR√úN</th>
      <th>ADET Fƒ∞YATI</th>
      <th>ALINAN ADET</th>
      <th>TOPLAM Fƒ∞YAT</th>`;
  const btn = document.getElementById("btnGenelToplam");
  btn.style.background = "#0078d7";
  document.getElementById("btnKullaniciEkle").disabled = false;
  toggleSatirButonlari(true);
  alert("Tablo sƒ±fƒ±rlandƒ±.");
}
</script>

</body>
</html>
