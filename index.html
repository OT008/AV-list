<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ürün Takip Sistemi</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 30px; }
  h2 { margin-bottom: 15px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; background: white; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #e9ecef; }
  input[type="number"], input[type="text"] { width: 90%; padding: 4px; }
  button { margin: 5px; padding: 6px 12px; border: none; border-radius: 6px; color: white; cursor: pointer; transition: background 0.3s; }
  #btnKullaniciEkle, #btnGenelToplam { background: #0078d7; }
  #btnTemizle { background: #dc3545; }
  button:hover:not(:disabled) { filter: brightness(0.9); }
  button:disabled { background: #b0b0b0 !important; cursor: not-allowed; }
  .btnAdd { background: #28a745; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-weight: bold; }
  .btnRemove { background: #dc3545; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-weight: bold; }
  #genelToplamSatir td { background: #fff8dc; font-weight: bold; }
</style>
</head>
<body>

<h2>Ürün Takip Sistemi</h2>

<div>
  <input type="text" id="kullaniciAdi" placeholder="Kullanıcı adı giriniz">
  <button id="btnKullaniciEkle" onclick="kullaniciEkle()">Kullanıcı Ekle</button>
  <button id="btnGenelToplam" onclick="genelToplam()">Genel Toplam</button>
  <button id="btnTemizle" onclick="tabloTemizle()">Tabloyu Temizle</button>
</div>

<table id="urunTablo">
  <thead>
    <tr id="baslikSatir">
      <th></th>
      <th>SİTE</th>
      <th>ÜRÜN</th>
      <th>ADET FİYATI</th>
      <th>ALINAN ADET</th>
      <th>TOPLAM FİYAT</th>
    </tr>
  </thead>
  <tbody id="urunBody">
    <tr>
      <td><button class="btnAdd" onclick="satirEkle(this)">+</button></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="number" min="0" value="0"></td>
      <td><input type="number" min="0" value="0"></td>
      <td class="readonly"></td>
    </tr>
  </tbody>
</table>

<script>
function kullaniciEkle() {
  const ad = document.getElementById("kullaniciAdi").value.trim();
  if (!ad) { alert("Lütfen bir kullanıcı adı giriniz."); return; }

  const baslik = document.getElementById("baslikSatir");
  const thAdet = document.createElement("th");
  thAdet.textContent = ad + " ADET";
  const thFiyat = document.createElement("th");
  thFiyat.textContent = ad + " FİYAT";
  baslik.appendChild(thAdet);
  baslik.appendChild(thFiyat);

  const satirlar = document.querySelectorAll("#urunBody tr");
  satirlar.forEach(tr => {
    const adet = document.createElement("td");
    adet.innerHTML = `<input type="number" min="0" value="0">`;
    const fiyat = document.createElement("td");
    fiyat.classList.add("readonly");
    tr.appendChild(adet);
    tr.appendChild(fiyat);
  });

  document.getElementById("kullaniciAdi").value = "";
}

function satirEkle(btn) {
  urunleriHesapla();
  const tr = btn.closest("tr");
  const tablo = document.getElementById("urunTablo");
  const yeniSatir = tr.cloneNode(true);

  // Tüm inputları sıfırla
  yeniSatir.querySelectorAll("input").forEach(inp => {
    inp.value = (inp.type === "number") ? 0 : "";
  });

  // Üstteki butonu "-" yap
  const ustBtn = tr.querySelector(".btnAdd");
  ustBtn.textContent = "−";
  ustBtn.className = "btnRemove";
  ustBtn.onclick = function() { satirSil(this); };

  // Yeni satırın ilk hücresi "+"
  const ilkHucre = yeniSatir.cells[0];
  ilkHucre.innerHTML = `<button class="btnAdd" onclick="satirEkle(this)">+</button>`;

  // Altına ekle
  tr.insertAdjacentElement("afterend", yeniSatir);
}

function satirSil(btn) {
  const tr = btn.closest("tr");
  tr.remove();
}

function urunleriHesapla() {
  const satirlar = document.querySelectorAll("#urunBody tr");
  satirlar.forEach(tr => {
    const fiyat = Number(tr.cells[3].querySelector("input").value);
    const adet = Number(tr.cells[4].querySelector("input").value);
    tr.cells[5].textContent = (fiyat * adet).toFixed(2);

    for (let j = 6; j < tr.cells.length; j += 2) {
      const adetK = tr.cells[j].querySelector("input");
      if (adetK) {
        const val = Number(adetK.value);
        const fiyatK = tr.cells[j + 1];
        fiyatK.textContent = (val * fiyat).toFixed(2);
      }
    }
  });
}

function genelToplam() {
  const btn = document.getElementById("btnGenelToplam");
  const tablo = document.getElementById("urunTablo");
  const mevcutSatir = document.getElementById("genelToplamSatir");
  const btnKullanici = document.getElementById("btnKullaniciEkle");

  if (mevcutSatir) {
    mevcutSatir.remove();
    btn.style.background = "#0078d7";
    btnKullanici.disabled = false;
    return;
  }

  urunleriHesapla();
  const satirlar = document.querySelectorAll("#urunBody tr");
  let hataVar = false;

  satirlar.forEach(tr => {
    let toplamAdet = 0;
    for (let j = 6; j < tr.cells.length; j += 2) {
      const adet = tr.cells[j].querySelector("input");
      if (adet) toplamAdet += Number(adet.value);
    }
    const alinan = Number(tr.cells[4].querySelector("input").value);
    const adetHucre = tr.cells[4].querySelector("input");
    if (alinan === toplamAdet) {
      adetHucre.style.background = "#90EE90";
    } else {
      adetHucre.style.background = "#FF6347";
      hataVar = true;
    }
  });

  if (hataVar) {
    btn.style.background = "#dc3545";
    alert("Bazı ürünlerde dağıtılan adet ile alınan adet eşleşmiyor!");
    return;
  }

  btn.style.background = "#28a745";

  const toplamSatirYeni = tablo.insertRow(-1);
  toplamSatirYeni.id = "genelToplamSatir";

  // "GENEL TOPLAM" hücresi (5 birleşik, çünkü 1 ek sütun var)
  const genelHucre = toplamSatirYeni.insertCell(0);
  genelHucre.colSpan = 5;
  genelHucre.textContent = "GENEL TOPLAM";
  genelHucre.style.textAlign = "center";

  // TOPLAM FİYAT sütunu
  let toplamFiyat = 0;
  satirlar.forEach(tr => toplamFiyat += Number(tr.cells[5].textContent) || 0);
  const tdToplam = toplamSatirYeni.insertCell(-1);
  tdToplam.textContent = toplamFiyat.toFixed(2) + " ₺";

  // Kişi sütunları
  const basliklar = document.querySelectorAll("#baslikSatir th");
  for (let i = 0; i < basliklar.length; i++) {
    if (basliklar[i].textContent.endsWith("FİYAT")) {
      const kisiAdi = basliklar[i].textContent.replace(" FİYAT", "").trim();
      let kisiToplam = 0;
      satirlar.forEach(tr => {
        const hucre = tr.cells[i];
        if (hucre) kisiToplam += Number(hucre.textContent) || 0;
      });

      const tdYazi = toplamSatirYeni.insertCell(-1);
      tdYazi.textContent = `${kisiAdi} Ödeyeceği`;
      const tdTutar = toplamSatirYeni.insertCell(-1);
      tdTutar.textContent = `${kisiToplam.toFixed(2)} ₺`;
    }
  }

  btnKullanici.disabled = true;
}

function tabloTemizle() {
  const tbody = document.getElementById("urunBody");
  tbody.innerHTML = `
    <tr>
      <td><button class="btnAdd" onclick="satirEkle(this)">+</button></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="number" min="0" value="0"></td>
      <td><input type="number" min="0" value="0"></td>
      <td class="readonly"></td>
    </tr>`;
  document.getElementById("baslikSatir").innerHTML = `
      <th></th>
      <th>SİTE</th>
      <th>ÜRÜN</th>
      <th>ADET FİYATI</th>
      <th>ALINAN ADET</th>
      <th>TOPLAM FİYAT</th>`;
  const btn = document.getElementById("btnGenelToplam");
  btn.style.background = "#0078d7";
  document.getElementById("btnKullaniciEkle").disabled = false;
  alert("Tablo sıfırlandı.");
}
</script>

</body>
</html>